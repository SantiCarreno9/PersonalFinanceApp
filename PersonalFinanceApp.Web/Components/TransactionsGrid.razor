@inherits CustomBase
@using Microsoft.AspNetCore.Components.QuickGrid

<QuickGrid Class="table table-hover w-100 align-middle" ItemsProvider="@TransactionItemsProvider" Pagination="state" @ref=TransactionGrid>
    <TemplateColumn Class="p-0 m-0">
        <HeaderTemplate>
            <div class="mb-1 mx-1 w-100 justify-content-center align-top">
                <input class="form-check-input m-0" type="checkbox" id="allCheckbox" @bind-value="@areAllItemsSelected" />
            </div>
        </HeaderTemplate>
        <ChildContent>
            <div class="d-flex w-100 justify-content-center my-2 px-1">
                <input class="form-check-input items-toggle" type="checkbox" onclick="onTransactionSelected(this)" @onchange="(value)=>OnTransactionSelected(context.Id,(bool)value.Value!)" />
            </div>
        </ChildContent>
    </TemplateColumn>
    <TemplateColumn Title="Location" Sortable="true">
        <ChildContent>
            <div @onclick="()=>OnTransactionClicked?.Invoke(context.Id)">
                @context.Location
            </div>
        </ChildContent>
    </TemplateColumn>
    <TemplateColumn Title="Date" Sortable="true">
        <div @onclick="()=>OnTransactionClicked?.Invoke(context.Id)">
            @context.Date.ToString("MMM dd, yyyy")
        </div>
    </TemplateColumn>
    <TemplateColumn Title="Payment Method" Sortable="true">
        <div @onclick="()=>OnTransactionClicked?.Invoke(context.Id)">
            @GetPaymentMethod(@context.PaymentMethodId)
        </div>
    </TemplateColumn>
    <TemplateColumn Title="Category" Sortable="true">
        <div @onclick="()=>OnTransactionClicked?.Invoke(context.Id)">
            @GetCategoryName(@context.CategoryId)
        </div>
    </TemplateColumn>
    @if (currentTransactionType == TransactionTypes.All)
    {
        <TemplateColumn Title="Type">
            <div @onclick="()=>OnTransactionClicked?.Invoke(context.Id)">
                @(context.TransactionTypeId == (byte)TransactionTypes.Expense ? "Expense" : "Income")
            </div>
        </TemplateColumn>
    }
    <TemplateColumn Title="Amount" Sortable="true">
        <div @onclick="()=>OnTransactionClicked?.Invoke(context.Id)">
            @context.TotalAmount.ToString("C")
        </div>
    </TemplateColumn>
</QuickGrid>
<Paginator State="state"></Paginator>

<script>
    const checkbox = document.getElementById('allCheckbox');
    const deleteButton = document.getElementById('deleteButton');    

    function onTransactionSelected(element) {
        if (element.checked) {
            deleteButton.disabled = false;
            console.log(element.parentElement.parentElement.parentElement)
            element.parentElement.parentElement.parentElement.classList.add("table-active");
        }
        else {
            element.parentElement.parentElement.parentElement.classList.remove("table-active");
            const elements = document.getElementsByClassName("items-toggle");
            for (let i = 0; i < elements.length; i++) {
                if (elements[i].checked) {
                    deleteButton.disabled = false;
                    return;
                }
            }
            deleteButton.disabled = true;
        }
    }

    checkbox.addEventListener('change', (event) => {
        const elements = document.getElementsByClassName("items-toggle");
        const e = new Event('change');
        for (let i = 0; i < elements.length; i++) {
            elements[i].checked = event.currentTarget.checked;
            elements[i].dispatchEvent(new Event('change')/*e*/);
        }
    });


</script>